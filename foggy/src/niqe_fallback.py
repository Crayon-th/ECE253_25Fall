"""Lightweight NIQE implementation used when piq/piqa are unavailable."""

from __future__ import annotations

import math
from typing import Tuple

import cv2
import numpy as np

_NIQE_PATCH_SIZE = 96
_GAUSSIAN_WINDOW = np.array(
    [0.000000000000000, 0.009294360000000, 0.067667640000000, 0.173470743000000, 0.286504796000000, 0.173470743000000, 0.067667640000000, 0.009294360000000, 0.000000000000000],
    dtype=np.float64,
)
_GAUSSIAN_WINDOW /= _GAUSSIAN_WINDOW.sum()
_GAUSSIAN_KERNEL = np.outer(_GAUSSIAN_WINDOW, _GAUSSIAN_WINDOW)

_NIQE_POP_MU = np.array(
    [
        2.906448260073254,
        0.991241513121221,
        0.867284798534799,
        0.033766826252267,
        0.191298631419577,
        0.240634516564513,
        0.863001373626374,
        0.046572841079660,
        0.180259155232154,
        0.248031505797588,
        0.864694597069596,
        -0.025021713563315,
        0.234614992578728,
        0.234614992578728,
        0.864347069597070,
        -0.024411512874525,
        0.233939350688437,
        0.233939350688437,
        3.093084249084246,
        1.005387722474340,
        0.887489468864470,
        0.027838829996467,
        0.205960172578068,
        0.246286554017561,
        0.879890567765567,
        0.040373479569692,
        0.193471625315693,
        0.252188871263330,
        0.884151556776557,
        -0.026137033943275,
        0.245385355049834,
        0.245385355049834,
        0.884286172161172,
        -0.026540888214662,
        0.245748531659118,
        0.245748531659118,
    ],
    dtype=np.float64,
)

_NIQE_POP_COV = np.array(
    [
        [0.927392192466050, 0.088554658367608, 0.112193933661125, 0.009055741204154, 0.053506288845355, 0.065525320619015, 0.112736377304270, 0.020341366465488, 0.045954270741192, 0.072354969149561, 0.107106985641185, 0.015134138189401, 0.046667975025126, 0.046651283700935, 0.105473760479778, 0.016003706498030, 0.045712536326222, 0.045693499552735, 0.267292426108308, 0.010389459846269, -0.000492613808523, 0.004310667629431, -0.007579521957971, -0.009232628925740, -0.001911274724557, 0.009288329104909, -0.009302136967030, -0.012897494435062, -0.007654732143965, -0.002832054302905, -0.008069959725819, -0.008076699040116, -0.006946170197288, -0.003332543038724, -0.008992072443583, -0.008999606851057],
